(()=>{function e(){try{const e="true"===localStorage.getItem("isLoggedIn"),o=localStorage.getItem("currentUser");console.log("Auth state check:",{isLoggedIn:e,hasCurrentUser:!!o});const n=document.getElementById("btn-login"),r=document.getElementById("btn-register"),l=document.getElementById("btn-logout");console.log("Button elements found:",{loginBtn:!!n,registerBtn:!!r,logoutBtn:!!l}),e&&o?(n&&n.classList.add("d-none"),r&&r.classList.add("d-none"),l&&(l.classList.remove("d-none"),console.log("Logout button should be visible now"))):(n&&n.classList.remove("d-none"),r&&r.classList.remove("d-none"),l&&(l.classList.add("d-none"),console.log("Logout button should be hidden now"))),t()}catch(e){console.error("Error updating navbar auth state:",e);const t=document.getElementById("btn-login"),o=document.getElementById("btn-register"),n=document.getElementById("btn-logout");t&&t.classList.remove("d-none"),o&&o.classList.remove("d-none"),n&&n.classList.add("d-none")}}function t(){const e=document.getElementById("btn-logout");e?(console.log("Setting up logout button event listener"),e.replaceWith(e.cloneNode(!0)),document.getElementById("btn-logout").addEventListener("click",(function(e){e.preventDefault(),console.log("Logout button clicked!"),o()})),console.log("Logout button event listener added")):console.log("Logout button not found")}function o(){console.log("handleLogout function called");try{localStorage.removeItem("currentUser"),localStorage.removeItem("token"),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("lastPrediction"),localStorage.removeItem("journalHistory"),console.log("LocalStorage cleared"),alert("Anda telah keluar."),e(),window.location.href="index.html"}catch(e){console.error("Error during logout:",e),alert("Terjadi kesalahan saat logout.")}}function n(){try{const e="true"===localStorage.getItem("isLoggedIn"),t=localStorage.getItem("currentUser"),o=localStorage.getItem("token");return e&&t&&o}catch(e){return console.error("Error checking authentication:",e),!1}}document.addEventListener("DOMContentLoaded",(()=>{console.log("navbar.js loaded"),e();const o=document.querySelector(".navbar-toggler"),n=document.querySelector("#navbarNav");o&&n?o.addEventListener("click",(()=>{console.log("Navbar toggler clicked"),n.classList.contains("show")?(n.classList.remove("show"),o.setAttribute("aria-expanded","false")):(n.classList.add("show"),o.setAttribute("aria-expanded","true"))})):console.error("Navbar toggler or collapse element not found"),t()})),window.updateNavbarAuthState=e,window.isAuthenticated=n,window.getCurrentUser=function(){try{return n()?JSON.parse(localStorage.getItem("currentUser")):null}catch(e){return console.error("Error getting current user:",e),null}},window.requireAuth=function(){return!!n()||(alert("Anda harus login terlebih dahulu untuk mengakses halaman ini."),window.location.href="login.html",!1)},window.handleLogout=o})();